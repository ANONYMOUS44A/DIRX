#!/bin/bash
# Created by Trabbit
# RAPS production
# R.C.S.A - DI


clear
trap 'echo -e "\nOperation aborted by the user."; exit' INT

#Installations
if [[ "$(uname -o 2>/dev/null)" == "Android" ]]; then
       pkg install apache2
else
       apt-get install apache2
fi

clear

function find_directories() {
    local url=$1
    local wordlist_file=$2

    while IFS= read -r directory; do
        target_url="$url/$directory/"
        response=$(curl -s -o /dev/null -w "%{http_code}" "$target_url")

        case $response in
            200)
                echo "[+] Found: $target_url (+)> 200 [accepted]"
                ;;
            403)
                echo "[+] Forbidden: $target_url (-)> 403"
                ;;
            404)
                echo "[+] Not Found: $target_url (-)> 404"
                ;;
            *)
                echo "Unexpected Status Code for $target_url (?)> $response"
                ;;
        esac
    done < "$wordlist_file"
}

# Read command line arguments
while getopts 'u:w:' flag; do
    case "${flag}" in
        u) target_url="${OPTARG}" ;;
        w) wordlist_path="${OPTARG}" ;;
        *) echo "Invalid option: ${flag}" ;;
    esac
done

# Check if required options are provided
if [[ -z "$target_url" || -z "$wordlist_path" ]]; then
    clear
    echo -e "\e[31mUsage: ./dirx -u <target_url> -w <wordlist_path>\e[0m"
    exit 1
fi

# Get Apache version and open ports
apache_version=$(httpd -v | awk -F'[ /]' '/Server version/ {print $4}')
open_ports=$(netstat -tuln | awk '/^tcp/ {print $4}' | cut -d: -f2 | paste -sd,)


echo
echo -e "|¯¯¯¯|\¯¯¯\‚|¯¯¯¯¯¯¯¯¯|'|¯¯¯¯|\¯¯¯\’|¯¯¯¯’|/¯¯¯¯/"
echo -e "|    |'|   ||__/| |\__|‚|    | |   ||__        / "
echo -e "|    |'|   ||¯¯\| |/¯¯|‚|    |/   /  /       ¯¯| "
echo -e "|____|/___/‚|_________|'|____|\___\’/____/|____| "
echo -e "                                        TRABBIT  "
echo -e "{>=============================================<}"
echo -e "| [+] TARGET / $target_url {-u}"
echo -e "| [+] WORDLIST / $wordlist_path {-w}"
echo -e "| [+] Apache Version: $apache_version"
echo -e "| [+] Open Ports: $open_ports"
echo -e "{>=============================================<}"
echo -e " \\\\\\ DIRECTORIES BRUTEFORCE STARTED \\\\\\"
echo -e "{>=============================================<}\n"

find_directories "$target_url" "$wordlist_path"

echo -e "{>=============================================<}"
echo -e "                      DONE.                      "
echo -e "{>=============================================<}"
